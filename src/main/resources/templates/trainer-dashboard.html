<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trainer Dashboard - Fitness Hub</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
</head>
<body>
<div th:replace="~{fragments-navbar :: navbar('TRAINER')}"></div>

<main class="dashboard">
    <!-- Success Message -->
    <div th:if="${param.created}" class="dashboard-card" style="background: rgba(34, 197, 94, 0.15); border: 1px solid rgba(34, 197, 94, 0.3);">
        <h3 style="color: #22c55e;"><i class="fas fa-check-circle"></i> Profile Created Successfully!</h3>
        <p>Welcome to Fitness Hub! Your trainer profile is now active.</p>
    </div>

    <!-- Profile Setup Alert -->
    <div th:if="${trainer == null}" class="dashboard-card" style="background: rgba(255, 152, 0, 0.15); border: 1px solid rgba(255, 152, 0, 0.3);">
        <h2><i class="fas fa-exclamation-triangle"></i> Complete Your Profile</h2>
        <p>Welcome! Please create your trainer profile to start using the system.</p>
        <a th:href="@{/trainer/profile/create}" class="btn btn-primary">Create Profile Now</a>
    </div>

    <!-- Trainer Profile Section -->
    <section class="dashboard-card" th:if="${trainer != null}">
        <h2><i class="fas fa-dumbbell"></i> <span th:text="${trainer.user.firstName + ' ' + trainer.user.lastName}"></span></h2>
        <div class="info-grid">
            <div class="info-item">
                <strong>Specialization:</strong>
                <p th:text="${trainer.specialization}"></p>
            </div>
            <div class="info-item">
                <strong>Hourly Rate:</strong>
                <p th:text="'$' + ${#numbers.formatDecimal(trainer.hourlyRate, 1, 2)}"></p>
            </div>
            <div class="info-item">
                <strong>Rating:</strong>
                <p th:text="${trainer.overallRating != null} ? ${#numbers.formatDecimal(trainer.overallRating, 1, 1)} : 'No ratings yet'"></p>
            </div>
        </div>
    </section>

    <div class="dashboard-grid">
        <div class="dashboard-card">
            <h3><i class="fas fa-user-circle"></i> My Profile</h3>
            <p>View and update your professional information</p>
            <a th:href="@{/trainer/profile}" class="btn btn-primary">Manage Profile</a>
        </div>

        <div class="dashboard-card">
            <h3><i class="fas fa-users"></i> My Sessions</h3>
            <p>View your scheduled training sessions with members</p>
            <a th:href="@{/trainer/bookings}" class="btn btn-primary">View Bookings</a>
        </div>
        
        <div class="dashboard-card">
            <h3><i class="fas fa-calendar-alt"></i> My Availability</h3>
            <p>Set your available time slots for bookings</p>
            <a th:href="@{/availability/trainer/manage}" class="btn btn-primary">Manage Availability</a>
        </div>

        <div class="dashboard-card">
            <h3><i class="fas fa-dumbbell"></i> Workout Plans</h3>
            <p>Create and assign personalized workout plans</p>
            <a th:href="@{/trainer/workout-plans}" class="btn btn-primary">Manage Plans</a>
        </div>

        <div class="dashboard-card" th:if="${trainer != null}">
            <h3><i class="fas fa-star"></i> My Ratings</h3>
            <p>View feedback from your clients</p>
            <a th:href="@{/ratings/trainer/{id}(id=${trainer.id})}" class="btn btn-primary">View Feedback</a>
        </div>

        <div class="dashboard-card" th:if="${trainer == null}">
            <h3><i class="fas fa-star"></i> My Ratings</h3>
            <p>View feedback from your clients</p>
            <button class="btn btn-secondary" disabled>Profile Required</button>
        </div>
    </div>
    <!-- Floating Chat Button -->
    <button id="chat-toggle" class="chat-fab">
        <i class="fas fa-comment-dots"></i>
    </button>

    <!-- Chat Modal -->
    <div id="chat-modal" class="chat-modal" style="display:none;">
        <div class="chat-header">
            <h3><i class="fas fa-robot"></i> Fitness Assistant</h3>
            <button id="chat-close" class="chat-close"><i class="fas fa-times"></i></button>
        </div>
        <div id="chat-body" class="chat-body">
            <div class="chat-message bot">Hello! How can I help you today? ðŸ’ª</div>
        </div>
        <div class="chat-footer">
            <input type="text" id="chat-input" placeholder="Type your message..."/>
            <button id="chat-send"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <style>
        .chat-fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #00ff88, #00cc66);
            border: none;
            border-radius: 50%;
            color: #000;
            font-size: 1.8rem;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(0,255,136,0.4);
            z-index: 999;
            transition: all 0.3s;
        }
        .chat-fab:hover { transform: scale(1.1); }

        .chat-modal {
            position: fixed;
            bottom: 110px;
            right: 30px;
            width: 380px;
            height: 520px;
            background: #1e1e1e;
            border-radius: 16px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.7);
            border: 1px solid #00ff8833;
            overflow: hidden;
            z-index: 998;
            display: flex;
            flex-direction: column;
        }
        .chat-header {
            background: #111;
            color: #00ff88;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .chat-close { background: none; border: none; color: #ff4444; font-size: 1.4rem; cursor: pointer; }
        .chat-body {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            background: #151515;
        }
        .chat-message {
            margin-bottom: 1rem;
            padding: 0.9rem 1.2rem;
            border-radius: 12px;
            max-width: 80%;
        }
        .chat-message.bot {
            background: #252525;
            align-self: flex-start;
        }
        .chat-message.user {
            background: #00ff8833;
            color: #000;
            align-self: flex-end;
            margin-left: auto;
        }
        .chat-footer {
            padding: 1rem;
            background: #1a1a1a;
            display: flex;
            gap: 0.8rem;
        }
        .chat-footer input {
            flex: 1;
            padding: 0.8rem 1rem;
            border: 1px solid #333;
            border-radius: 12px;
            background: #222;
            color: white;
        }
        .chat-footer button {
            background: #00ff88;
            color: #000;
            border: none;
            padding: 0.8rem 1.2rem;
            border-radius: 12px;
            cursor: pointer;
        }
    </style>

    <script>
        // Simple chat toggle (add real backend later)
        const chatToggle = document.getElementById('chat-toggle');
        const chatModal = document.getElementById('chat-modal');
        const chatClose = document.getElementById('chat-close');
        const chatInput = document.getElementById('chat-input');
        const chatSend = document.getElementById('chat-send');
        const chatBody = document.getElementById('chat-body');

        chatToggle?.addEventListener('click', () => {
            chatModal.style.display = chatModal.style.display === 'flex' ? 'none' : 'flex';
            if (chatModal.style.display === 'flex') chatInput.focus();
        });

        chatClose?.addEventListener('click', () => {
            chatModal.style.display = 'none';
        });

        chatSend?.addEventListener('click', sendChatMessage);
        chatInput?.addEventListener('keypress', e => {
            if (e.key === 'Enter') sendChatMessage();
        });

        function sendChatMessage() {
            const text = chatInput.value.trim();
            if (!text) return;

            // User message
            const userMsg = document.createElement('div');
            userMsg.className = 'chat-message user';
            userMsg.textContent = text;
            chatBody.appendChild(userMsg);

            // Fake bot reply (replace with real API later)
            setTimeout(() => {
                const botMsg = document.createElement('div');
                botMsg.className = 'chat-message bot';
                botMsg.innerHTML = getBotReply(text);
                chatBody.appendChild(botMsg);
                chatBody.scrollTop = chatBody.scrollHeight;
            }, 800);

            chatInput.value = '';
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        function getBotReply(text) {
            text = text.toLowerCase();
            if (text.includes('hello') || text.includes('hi')) return "Hey! Ready to crush your goals today? ðŸ’ª";
            if (text.includes('workout') || text.includes('plan')) return "I can help with workout plans! Tell me your goal: build muscle, lose fat, or endurance?";
            return "I'm here to help! What would you like to know about training, nutrition, or recovery?";
        }
    </script>
</main>
</body>
</html>